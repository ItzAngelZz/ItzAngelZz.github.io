<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego de Preguntas</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
    <style>
        /* Estilos previos */
        /* (El mismo estilo que has usado anteriormente) */
    </style>
</head>
<body>
    <h1>Juego de Preguntas</h1>
    <div id="game-container">
        <div id="lives">Vidas restantes: 3</div>
        <div id="game-status" style="display: none;"></div>
        <div id="question-container" class="question-container">
            <p id="question-text">Cargando pregunta...</p>
            <div id="options" class="buttons-container"></div>
        </div>
    </div>

    <div id="timers">
        <div id="time-played" class="timer-box">Tiempo jugando: 0s</div>
        <div id="time-left" class="timer-box">Tiempo restante: 30s</div>
    </div>

    <script>
        const questions = [
            {
                question: "¿Cuándo nos conocimos?",
                options: ["15 de abril", "20 de abril", "25 de mayo", "10 de marzo"],
                answer: "20 de abril"
            },
            {
                question: "¿Dónde nos besamos por primera vez?",
                options: ["En el parque", "En un sofá", "En la playa", "En un cine"],
                answer: "En un sofá"
            },
            {
                question: "¿Qué pasó en nuestra primera cita?",
                options: ["Me caí de la silla", "No pude ir por pena", "Nos perdimos", "Pedí una pizza equivocada"],
                answer: "No pude ir por pena"
            },
            {
                question: "¿Cómo te decía cuando empezamos a ser novios?",
                options: ["Corazón", "Amor", "MyLove", "Mi cielo"],
                answer: "MyLove"
            },
            {
                question: "¿Cuál fue el primer regalo que te di?",
                options: ["Un anillo", "Un peluche", "Un libro", "Un perfume"],
                answer: "Un peluche"
            },
            {
                question: "¿Cuántos hijos tenemos?",
                options: ["2", "4", "3", "5"],
                answer: "4"
            },
            {
                question: "¿Cuál fue la primera película que vimos?",
                options: ["Titanic", "Satan", "The Notebook", "Inception"],
                answer: "Satan"
            },
            {
                question: "¿Cuál fue la película que nunca terminamos de ver?",
                options: ["Toy Story", "Up", "Los Increíbles", "Frozen"],
                answer: "Up"
            },
            {
                question: "¿Cuántos meses llevamos juntos?",
                options: ["5 meses", "10 meses", "9 meses", "12 meses"],
                answer: "9 meses"
            },
            {
                question: "¿Cuál fue tu reacción cuando te pedí ser mi novia?",
                options: ["Grité de emoción", "No lo podía creer", "Me puse nerviosa", "Te dije que no"],
                answer: "Me puse nerviosa"
            }
        ];

        let currentQuestion = 0;
        let score = 0;
        let lives = 3;
        let totalTime = 30;
        let timePlayed = 0;
        let questionTimer;
        let gameTimer;
        let correctAnswers = 0;
        let incorrectAnswers = 0;

        const questionText = document.getElementById("question-text");
        const optionsContainer = document.getElementById("options");
        const gameStatus = document.getElementById("game-status");
        const livesContainer = document.getElementById("lives");
        const timePlayedContainer = document.getElementById("time-played");
        const timeLeftContainer = document.getElementById("time-left");

        function updateGameTimer() {
            timePlayed++;
            timePlayedContainer.textContent = `Tiempo jugado: ${timePlayed}s`;
        }

        function updateQuestionTimer() {
            if (totalTime > 0) {
                totalTime--;
                timeLeftContainer.textContent = `Tiempo restante: ${totalTime}s`;
            } else {
                clearInterval(questionTimer);
                endGame(false); // Se acaba el tiempo de la pregunta
            }
        }

        function startGame() {
            gameTimer = setInterval(updateGameTimer, 1000); // Timer general para todo el juego
            loadQuestion();
        }

        function loadQuestion() {
            totalTime = 30; // Reinicia el temporizador para la nueva pregunta
            clearInterval(questionTimer); // Detenemos el temporizador anterior
            questionTimer = setInterval(updateQuestionTimer, 1000); // Iniciamos uno nuevo
            const current = questions[currentQuestion];
            questionText.textContent = current.question;
            optionsContainer.innerHTML = "";

            current.options.forEach(option => {
                const optionButton = document.createElement("button");
                optionButton.textContent = option;
                optionButton.classList.add("button");
                optionButton.onclick = () => checkAnswer(option);
                optionsContainer.appendChild(optionButton);
            });
        }

        function checkAnswer(selectedOption) {
            const correctAnswer = questions[currentQuestion].answer;
            if (selectedOption === correctAnswer) {
                score++;
                correctAnswers++;
                gameStatus.textContent = "¡Correcto!";
                gameStatus.classList.add("correct");
                gameStatus.classList.remove("incorrect");
            } else {
                incorrectAnswers++;
                lives--;
                gameStatus.textContent = "¡Incorrecto!";
                gameStatus.classList.add("incorrect");
                gameStatus.classList.remove("correct");
            }
            gameStatus.classList.add("animateMessage");
            gameStatus.style.display = "block";
            setTimeout(() => {
                gameStatus.style.display = "none";
                if (lives <= 0 || currentQuestion === questions.length - 1) {
                    endGame(false); // Juego perdido por vidas agotadas o fin de las preguntas
                } else {
                    currentQuestion++;
                    loadQuestion();
                }
            }, 1500);
            livesContainer.textContent = `Vidas restantes: ${lives}`;
        }

        function endGame(won) {
            clearInterval(questionTimer); // Detener el temporizador de la pregunta
            clearInterval(gameTimer); // Detener el temporizador del juego
            const gameContainer = document.getElementById("game-container");

            const percentage = (correctAnswers / questions.length) * 100;

            if (percentage >= 80) {
                gameContainer.innerHTML = `
                    <h2>¡Felicidades, has ganado!</h2>
                    <p>Respondiste correctamente el ${percentage}% de las preguntas.</p>
                `;
                gameContainer.innerHTML += `
                    <button class="button" onclick="takeScreenshot()">Tomar captura de pantalla</button>
                    <button class="button" onclick="goToHome()">Volver al Inicio</button>
                `;
            } else {
                gameContainer.innerHTML = `
                    <h2>¡Juego Terminado!</h2>
                    <p>Respondiste correctamente el ${percentage}% de las preguntas.</p>
                `;
                gameContainer.innerHTML += `
                    <button class="button" onclick="restartGame()">Reiniciar Juego</button>
                    <button class="button" onclick="goToHome()">Volver al Inicio</button>
                `;
            }
        }

        function takeScreenshot() {
            html2canvas(document.body).then(function(canvas) {
                const screenshotUrl = canvas.toDataURL("image/png");
                // Aquí puedes enviar la captura de pantalla por WhatsApp o guardarla.
                console.log(screenshotUrl);  // Esto te da la URL de la imagen capturada
            });
        }

        function restartGame() {
            location.reload();
        }

        function goToHome() {
            window.location.href = "index.html"; // Redirige al archivo index.html
        }

        startGame();
    </script>
</body>
</html>
